# RSS Feeder - Technical Specifications

## Processing Flow Details

### 0. Daemon Mode Operation (main.js)

- Start daemon mode with `npm run daemon`
- Initialize built-in scheduler with node-cron
- Automatic execution with specified cron expression (default: every 12 hours)
- Graceful shutdown support (SIGTERM/SIGINT)
- One-time execution mode available with `SCHEDULE_ENABLED=false`

### 1. RSS Feed Fetching (feedFetcher.js)

- Read feed URL list from `.env` file or `RSS_FEEDS` environment variable
- Fallback: Read from `config/feeds.json` file
- Execute HTTP requests with `axios`
- Parse XML with `rss-parser`
- Error handling: Skip failed feeds
- Remove duplicate articles (based on title + link)
- Filter articles from current day

### 2. AI Processing (llmProcessor.js)

#### Tagging Process

- Use Gemini API (`gemini-2.5-flash`)
- Analyze article titles and descriptions
- Configurable hierarchical tag system from `config/tags.json`
- Dynamic tag list generation for AI prompts
- Automatically assign parent tag + relevant subtags
- Maximum tags per article configurable (default: 3)
- Rate limiting: Configurable request intervals
- Fallback handling for unrecognized tags

#### Summary Generation

- Process articles grouped by tags
- Generate Japanese summaries for each group
- Include main topics, trends, and highlighted articles
- Summarize English articles in Japanese

### 3. Obsidian Integration (obsidianAPI.js)

- Connect to Obsidian Local REST API (https://127.0.0.1:27124/)
- Configure Vault internal paths according to tag hierarchy
- Generate markdown with YAML frontmatter
- Create date-based index files
- Create files in Obsidian Vault in real-time
- Connection testing and error handling

## Configuration Management

#### Environment Variables List

```bash
# Required
GEMINI_API_KEY          # Gemini API key
OBSIDIAN_API_KEY        # Obsidian Local REST API key

# Optional
RSS_FEEDS              # JSON array of RSS feed URLs (takes precedence over feeds.json)
OBSIDIAN_API_URL       # Obsidian API URL (default: https://127.0.0.1:27124/)
DEBUG                  # Debug mode (default: false)
TIMEZONE               # Timezone (default: Asia/Tokyo)
MAX_RETRIES            # Maximum retry count (default: 3)
GEMINI_MODEL           # Gemini model name (default: gemini-2.5-flash)
GEMINI_REQUEST_DELAY   # API call interval in ms (default: 1000)
RETRY_DELAY            # Retry interval in ms (default: 1000)

# Scheduler Settings
SCHEDULE_ENABLED       # Enable scheduler (default: true)
SCHEDULE_CRON          # Cron expression (default: "0 */12 * * *")
SCHEDULE_TIMEZONE      # Scheduler timezone (default: TIMEZONE value)
RUN_ON_START           # Run immediately on startup (default: false)
ENABLE_HOURLY_FILES    # Enable hourly file generation (default: false)
```

#### Tag Configuration (config/tags.json)

The system uses a configurable tag hierarchy defined in `config/tags.json`:

```json
{
  "tags": {
    "ai": {
      "display": "AI",
      "description": "Artificial Intelligence and Machine Learning",
      "subtags": ["llm", "rag", "ml", "cv", "nlp", "chatbot"]
    },
    "tech": {
      "display": "Technology",
      "description": "Technology and Software Development",
      "subtags": ["web", "mobile", "devops", "security", "programming"]
    }
  },
  "config": {
    "maxTagsPerArticle": 3,
    "defaultTag": "uncategorized",
    "allowMultipleParentTags": false
  }
}
```

**Tag System Features:**

- Hierarchical tags with parent and subtags
- Configurable via JSON file
- Fallback to default tags if config file missing
- Automatic parent+subtag assignment (e.g., "ai, llm")
- Validation and error handling

## Output Format

### Obsidian Vault Structure

```
Obsidian Vault/
└── RSS/
    └── YYYY-MM-DD/
        ├── index.md              # Daily overview
        ├── tech/
        │   ├── ai.md            # AI-related articles
        │   ├── web.md           # Web development related
        │   └── security.md      # Security related
        ├── business.md          # Business related
        └── science.md           # Science related
```

### Markdown File Structure

```markdown
---
date: YYYY-MM-DD
tag: tech/ai
count: 5
tags: [tech, ai]
generated: ISO8601_timestamp
---

# TAG_NAME - Japanese Date

## Overview

Japanese summary generated by Gemini API

**Article Count**: N articles

## Article List

### 1. Article Title

**Link**: [URL](URL)
**Source**: Feed name
**Author**: Creator
**Published**: Date and time
**Summary**: Article description
**Tags**: Tag list
```
